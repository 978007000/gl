<script>
	import Mesh from '../scene/Mesh.svelte';
	import Geometry from '../abstract/Geometry.mjs';
	import Attribute from '../abstract/Attribute.mjs';

	import icosphere from 'icosphere';
	import { faceNormals, vertexNormals } from 'normals';

	export let subdivisions = 1;

	const { positions, cells } = icosphere(subdivisions);

	const position = new Attribute({
		data: new Float32Array(positions.flat()),
		size: 3
	});

	const vn = vertexNormals(cells, positions).flat();
	const fn = faceNormals(cells, positions).flat();

	const position_strings = new Set();
	positions.forEach(pos => {
		const str = pos.join(',');
		if (position_strings.has(str)) {
			throw new Error(`seen ${str}`);
		}
		position_strings.add(str);
	});

	const normal = new Attribute({
		data: new Float32Array(vertexNormals(cells, positions).flat()),
		size: 3
	});

	const index = new Uint32Array(cells.flat());

	const geometry = new Geometry({ position, normal }, { index });
</script>

<Mesh {...$$props} {geometry}/>